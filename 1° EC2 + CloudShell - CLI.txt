GRUPO_SEGURANCA="XXXXXXX-grupo"
NOME_INSTANCIA="instancia-XXXXXXXX"
PAR_CHAVE="parchave-XXXXXXX"

SECURITY_GROUP_ID=$(aws ec2 create-security-group --group-name $GRUPO_SEGURANCA --description "Permitir HTTP" --query "GroupId" --output text)

aws ec2 authorize-security-group-ingress --group-id $SECURITY_GROUP_ID --protocol tcp --port 80 --cidr 0.0.0.0/0

aws ec2 run-instances \
    --instance-type t2.micro \
    --image-id $(aws ssm get-parameters-by-path --path "/aws/service/ami-amazon-linux-latest" --query "Parameters[?ends_with(Name, 'al2023-ami-kernel-default-x86_64')].Value" --output text) \
    --security-group-ids $SECURITY_GROUP_ID \
    --tag-specifications "ResourceType=instance,Tags=[{Key=Name,Value=$NOME_INSTANCIA}]" \
    --key-name $PAR_CHAVE \
    --user-data "QmVtLXZpbmRvIGFvIG1ldSBwZXJmaWwhIFNvdSB1bSBlbnR1c2lhc3RhIGRhIHRlY25vbG9naWEgZSBhdHVhbG1lbnRlIGVzdG91IGN1cnNhbmRvIEFuw6FsaXNlIGUgRGVzZW52b2x2aW1lbnRvIGRlIFNpc3RlbWFzIG5hIFVuaXZlcnNpZGFkZSBVbmlhc3NlbHZpLCB0dXJtYSBkZSAyMDI0LgpBY3JlZGl0byBxdWUgYSB0ZWNub2xvZ2lhIMOpIHVtYSBkYXMgZm9yw6dhcyBtb3RyaXplcyBkbyBtdW5kbyBlLCBwb3IgaXNzbywgdmVqbyBhIHBvc2nDp8OjbyBkZSBjb25zdWx0b3JhIGRlIFRJIGNvbW8gYWxnbyBlc3NlbmNpYWwgbmEgbWluaGEgam9ybmFkYSBwcm9maXNzaW9uYWwuIEJ1c2NvIGNvbnN0YW50ZW1lbnRlIG1lbGhvcmFyIGUgZXhwYW5kaXIgbWV1IGNvbmhlY2ltZW50bywgbyBxdWUgbWUgbGV2b3UgYSBmYXplciB1bSBjdXJzbyBkZSBDbG91ZCBDb21wdXRpbmcsIGFkaWNpb25hbmRvIGhhYmlsaWRhZGVzIHZhbGlvc2FzIGFvIG1ldSBjdXJyw61jdWxvLgpBdHVhbG1lbnRlLCBtZXUgZm9jbyBlc3TDoSBlbSBhcHJpbW9yYXIgbWluaGFzIGhhYmlsaWRhZGVzIHByb2dyYW1hw6fDo28sIGFycXVpdGV0dXJhIGRlIGNvbXB1dGFkb3JlcyBlIGRlc2Vudm9sdmltZW50byBkZSBzaXN0ZW1hcyB3ZWIuIEFsw6ltIGRpc3NvLCBlc3RvdSBkZWRpY2FuZG8gbWUgYSBhcHJlbmRlciBJbnRlbGlnw6puY2lhIEFydGlmaWNpYWwgZSBNYWNoaW5lIExlYXJuaW5nIHBhcmEgYXByb2Z1bmRhciBtZXUgY29uaGVjaW1lbnRvIG5lc3NhIG5vdmEgdGVjbm9sb2dpYXMgcXVlIHBlcm1pdGUgYW9zIGNvbXB1dGFkb3JlcyBzaW11bGFyIGEgaW50ZWxpZ8OqbmNpYSBodW1hbmEuCk5vcyBtZXVzIG1vbWVudG9zIGRlIGxhemVyLCBnb3N0byBkZSBpbnRlcmFnaXIgY29tIG1pbmhhIGZhbcOtbGlhIGUgYW1pZ29zLCBmb3RvZ3JhZmlhLCBleGVyY8OtY2lvcyBmw61zaWNvLCBhcHJlY2lhciBhIG5hdHVyZXphLCB2aWFnZW5zIHR1csOtc3RpY2FzIGUgY3VsdHVyYWwsIGVuY29udHJhbmRvIHVtIGVxdWlsw61icmlvIHBlcmZlaXRvIGVudHJlIHRyYWJhbGhvIGUgZGl2ZXJzw6NvLgpFc3RvdSBzZW1wcmUgYWJlcnRhIGEgbm92b3MgZGVzYWZpb3MgZSBvcG9ydHVuaWRhZGVzIGRlIGNvbGFib3Jhw6fDo28uIFBvcnRhbnRvLCBzaW50YS1zZSDDoCB2b250YWRlIHBhcmEgZXhwbG9yYXIgbWV1cyBwcm9qZXRvcyBubyBHaXRIdWIgZSBlbnRyYXIgZW0gY29udGF0byBwYXJhIGRpc2N1dGlyIGlkZWlhcywgY29sYWJvcmHDp8O1ZXMgb3Ugc2ltcGxlc21lbnRlIGNvbXBhcnRpbGhhciBleHBlcmnDqm5jaWFzIHNvYnJlIHRlY25vbG9naWEgZSBkZXNlbnZvbHZpbWVudG8uCk9icmlnYWRhIHBvciB2aXNpdGFyIG1ldSBwZXJmaWwgZSB2YW1vcyBlbWJhcmNhciBqdW50b3MgbmVzc2Egam9ybmFkYSBkZSBhcHJlbmRpemFkbyBlIGNyZXNjaW1lbnRvIG5lc3RlIHZhc3RvIGUgc3VycHJlZW5kZW50ZSB1bml2ZXJzbyB0ZWNub2zDs2dpY28u"